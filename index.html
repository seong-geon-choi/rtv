<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실시간 TV</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>실시간 TV 시청</h1>
            <p>무료로 실시간 TV를 시청하세요</p>
        </header>
        
        <main class="channels">
            <div class="channel-grid" id="mainChannels">
                <a href="https://onair.imbc.com/" target="_blank" class="channel-card" draggable="true" data-channel="mbc">
                    <div class="channel-logo mbc">
                        <img src="https://www.imbc.com/favicon.ico" alt="MBC" onerror="this.style.display='none'">
                        MBC
                    </div>
                    <div class="channel-btn">시청하기</div>
                </a>

                <a href="https://www.sbs.co.kr/live" target="_blank" class="channel-card" draggable="true" data-channel="sbs">
                    <div class="channel-logo sbs">
                        <img src="https://www.sbs.co.kr/favicon.ico" alt="SBS" onerror="this.style.display='none'">
                        SBS
                    </div>
                    <div class="channel-btn">시청하기</div>
                </a>

                <a href="https://onair.kbs.co.kr/index.html?sname=onair&stype=live&ch_code=12" target="_blank" class="channel-card" draggable="true" data-channel="kbs2">
                    <div class="channel-logo kbs2">
                        <img src="https://www.kbs.co.kr/favicon.ico" alt="KBS2" onerror="this.style.display='none'">
                        KBS2
                    </div>
                    <div class="channel-btn">시청하기</div>
                </a>

                <a href="https://www.ebs.co.kr/onair" target="_blank" class="channel-card" draggable="true" data-channel="ebs">
                    <div class="channel-logo ebs">
                        <img src="https://www.ebs.co.kr/favicon.ico" alt="EBS" onerror="this.style.display='none'">
                        EBS
                    </div>
                    <div class="channel-btn">시청하기</div>
                </a>

                <a href="https://onair.kbs.co.kr/index.html?sname=onair&stype=live&ch_code=11" target="_blank" class="channel-card" draggable="true" data-channel="kbs1">
                    <div class="channel-logo kbs1">
                        <img src="https://www.kbs.co.kr/favicon.ico" alt="KBS1" onerror="this.style.display='none'">
                        KBS1
                    </div>
                    <div class="channel-btn">시청하기</div>
                </a>
            </div>

            <div class="channel-grid" id="otherChannels">
                <a href="https://01.ondotv.com/" target="_blank" class="channel-card" draggable="true" data-channel="ondotv">
                    <div class="channel-logo">
                        <img src="https://01.ondotv.com/favicon.ico" alt="온도티비" onerror="this.style.display='none'">
                        온도티비
                    </div>
                    <div class="channel-btn">시청하기</div>
                </a>

                <a href="https://tvchak153.com/" target="_blank" class="channel-card" draggable="true" data-channel="tvchak">
                    <div class="channel-logo">
                        <img src="https://tvchak153.com/favicon.ico" alt="티비착" onerror="this.style.display='none'">
                        티비착
                    </div>
                    <div class="channel-btn">시청하기</div>
                </a>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mainChannels = document.getElementById('mainChannels');
            const otherChannels = document.getElementById('otherChannels');
            let draggedCard = null;
            let touchStartX, touchStartY;

            // 저장된 순서 불러오기
            function loadChannelOrder() {
                const mainOrder = localStorage.getItem('mainChannelsOrder');
                const otherOrder = localStorage.getItem('otherChannelsOrder');

                if (mainOrder) {
                    const mainOrderArray = JSON.parse(mainOrder);
                    reorderChannels(mainChannels, mainOrderArray);
                }

                if (otherOrder) {
                    const otherOrderArray = JSON.parse(otherOrder);
                    reorderChannels(otherChannels, otherOrderArray);
                }
            }

            // 채널 순서 저장하기
            function saveChannelOrder() {
                const mainOrder = Array.from(mainChannels.children).map(card => card.dataset.channel);
                const otherOrder = Array.from(otherChannels.children).map(card => card.dataset.channel);

                localStorage.setItem('mainChannelsOrder', JSON.stringify(mainOrder));
                localStorage.setItem('otherChannelsOrder', JSON.stringify(otherOrder));
            }

            // 채널 순서 재정렬
            function reorderChannels(container, orderArray) {
                const currentCards = Array.from(container.children);
                const orderedCards = [];

                orderArray.forEach(channelId => {
                    const card = currentCards.find(card => card.dataset.channel === channelId);
                    if (card) {
                        orderedCards.push(card);
                    }
                });

                // 순서가 저장되지 않은 카드들도 추가
                currentCards.forEach(card => {
                    if (!orderedCards.includes(card)) {
                        orderedCards.push(card);
                    }
                });

                container.innerHTML = '';
                orderedCards.forEach(card => container.appendChild(card));
            }

            // 드래그 앤 드롭 이벤트 처리
            document.querySelectorAll('.channel-card').forEach(card => {
                card.addEventListener('dragstart', function(e) {
                    draggedCard = this;
                    this.classList.add('dragging');
                    // 링크 이동 방지
                    e.preventDefault();
                });

                card.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                    saveChannelOrder();
                });

                // 터치 이벤트 처리
                card.addEventListener('touchstart', function(e) {
                    draggedCard = this;
                    touchStartX = e.touches[0].clientX;
                    touchStartY = e.touches[0].clientY;
                    this.classList.add('dragging');
                });

                card.addEventListener('touchmove', function(e) {
                    if (!draggedCard) return;

                    e.preventDefault();
                    const touch = e.touches[0];
                    const moveX = touch.clientX - touchStartX;
                    const moveY = touch.clientY - touchStartY;

                    this.style.transform = `translate(${moveX}px, ${moveY}px)`;
                });

                card.addEventListener('touchend', function() {
                    if (!draggedCard) return;

                    this.style.transform = '';
                    this.classList.remove('dragging');
                    saveChannelOrder();
                    draggedCard = null;
                });

                // 클릭 이벤트 처리
                card.addEventListener('click', function(e) {
                    if (this.classList.contains('dragging')) {
                        e.preventDefault();
                    }
                });
            });

            [mainChannels, otherChannels].forEach(container => {
                container.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    const afterElement = getDragAfterElement(container, e.clientY);
                    const draggable = document.querySelector('.dragging');
                    if (afterElement == null) {
                        container.appendChild(draggable);
                    } else {
                        container.insertBefore(draggable, afterElement);
                    }
                });
            });

            function getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll('.channel-card:not(.dragging)')];

                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }

            // 초기 순서 불러오기
            loadChannelOrder();
        });
    </script>
</body>
</html>